# CNB äº‘åŸç”Ÿæ„å»ºé…ç½®æ–‡ä»¶
# ç”¨äºè‡ªåŠ¨æ‰“åŒ… Electron åº”ç”¨

# åˆ†æ”¯å
main:
  # äº‹ä»¶ï¼šä»£ç æ¨é€æ—¶è§¦å‘
  push:
    # æµæ°´çº¿é…ç½®
    - name: build-electron-app
      # Docker ç¯å¢ƒ
      docker:
        image: node:18
        # ç¼“å­˜ node_modulesï¼ˆä½¿ç”¨å†™æ—¶å¤åˆ¶ï¼‰
        volumes:
          - node_modules:copy-on-write

      # ç¯å¢ƒå˜é‡
      env:
        CSC_IDENTITY_AUTO_DISCOVERY: "false"

      # æ„å»ºæ­¥éª¤ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰
      stages:
        - name: å®‰è£…ä¾èµ–
          script: |
            echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
            npm ci

        - name: æ„å»ºå‰ç«¯
          script: |
            echo "ğŸ¨ æ„å»ºå‰ç«¯..."
            npm run build:renderer

        - name: æ„å»ºä¸»è¿›ç¨‹
          script: |
            echo "âš™ï¸ æ„å»ºä¸»è¿›ç¨‹..."
            npm run build:main

        - name: æ‰“åŒ…åº”ç”¨
          script: |
            echo "ğŸ“¦ æ‰“åŒ…åº”ç”¨..."
            npm run pack
            echo "âœ… æ‰“åŒ…å®Œæˆ"
            ls -lh build-output/ || true

        - name: æ˜¾ç¤ºæ‰“åŒ…ç»“æœ
          script: |
            echo "=== æ‰“åŒ…äº§ç‰© ==="
            find build-output -type f -name "*.exe" -o -name "*.zip" || true

      # ä¿å­˜æ„å»ºäº§ç‰©
      artifacts:
        - build-output/**/*

