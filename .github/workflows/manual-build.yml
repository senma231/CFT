name: æ‰‹åŠ¨æ‰“åŒ…

on:
  workflow_dispatch:  # åªå…è®¸æ‰‹åŠ¨è§¦å‘
    inputs:
      create_release:
        description: 'æ˜¯å¦åˆ›å»º Release'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

jobs:
  build-windows:
    name: æ‰“åŒ… Windows ç‰ˆæœ¬
    runs-on: windows-latest
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: ğŸ”§ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci
      
      - name: ğŸ¨ æ„å»ºå‰ç«¯
        run: npm run build:renderer
      
      - name: âš™ï¸ æ„å»ºä¸»è¿›ç¨‹
        run: npm run build:main
        env:
          CSC_IDENTITY_AUTO_DISCOVERY: false
      
      - name: ğŸ“¦ æ‰“åŒ…åº”ç”¨
        run: npm run pack
        env:
          CSC_IDENTITY_AUTO_DISCOVERY: false
      
      - name: ğŸ“Š æ˜¾ç¤ºæ‰“åŒ…ç»“æœ
        run: |
          Write-Host "=== æ‰“åŒ…å®Œæˆ ===" -ForegroundColor Green
          Get-ChildItem build-output -Recurse -File | Where-Object {
            $_.Extension -in @('.exe', '.zip')
          } | ForEach-Object {
            $size = [math]::Round($_.Length / 1MB, 2)
            Write-Host "âœ“ $($_.Name) - ${size} MB" -ForegroundColor Cyan
          }
      
      - name: ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: Cloudflareéš§é“ç®¡ç†å™¨-Windows-x64
          path: |
            build-output/*.exe
            build-output/*.zip
          retention-days: 30
      
      - name: ğŸš€ åˆ›å»º Release
        if: github.event.inputs.create_release == 'true'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.run_number }}
          name: Release v${{ github.run_number }}
          files: |
            build-output/*.exe
            build-output/*.zip
          draft: false
          prerelease: false
          body: |
            ## Cloudflare éš§é“ç®¡ç†å™¨

            ### ğŸ“¦ ä¸‹è½½
            - **Windows 64ä½**: Cloudflareéš§é“ç®¡ç†å™¨-v2.0.0-win-x64.zip
            
            ### âœ¨ åŠŸèƒ½ç‰¹æ€§
            - éš§é“ç®¡ç†
            - ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ
            - è‡ªåŠ¨æ›´æ–°
            
            ### ğŸ“ æ›´æ–°æ—¥å¿—
            è‡ªåŠ¨æ„å»º #${{ github.run_number }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

